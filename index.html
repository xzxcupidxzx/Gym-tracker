<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Gym Tracker - Quáº£n lÃ½ táº­p luyá»‡n thÃ´ng minh</title>
    <meta name="description" content="á»¨ng dá»¥ng theo dÃµi vÃ  quáº£n lÃ½ táº­p luyá»‡n gym vá»›i AI">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Gym Tracker">

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/x-icon" href="/icon/favicon.ico">
    <link rel="icon" type="image/png" sizes="96x96" href="/icon/Gym-favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon/Gym-192x192.png">
    <link rel="apple-touch-icon" href="/icon/Gym-apple-touch-icon.png">
    <link rel="stylesheet" href="css/main.css">
    
    <!-- Chart.js Preload (cho analytics) -->
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>
    <audio id="sound-beep" src="sounds/beep.mp3" preload="auto"></audio>
    <audio id="sound-done" src="sounds/done.mp3" preload="auto"></audio>

    <!-- Install Banner -->
    <div id="install-banner" class="install-banner" style="display:none;">
        <div class="install-content">
            <span>ğŸ“± CÃ i Ä‘áº·t Gym Tracker Ä‘á»ƒ dÃ¹ng offline</span>
            <button class="btn btn-primary btn-sm" id="install-btn">CÃ i Ä‘áº·t</button>
            <button class="btn-close" onclick="hideInstallBanner()">Ã—</button>
        </div>
    </div>

    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator" style="display:none;">
        <span>ğŸ“¡ Äang offline</span>
    </div>

    <!-- Header -->
    <header class="app-header">
        <div class="container">
            <div class="header-content">
                <h1 class="app-title">ğŸ’ª Gym Tracker</h1>
                <div class="header-actions">
                    <button class="icon-btn" onclick="app.openBackendSettings()" title="Sync Settings">
                        <span id="sync-status">â˜ï¸</span>
                    </button>
                    <button class="icon-btn" onclick="app.openSettings()" title="Settings">âš™ï¸</button>
                    <button class="menu-toggle" id="menu-toggle" aria-label="Toggle menu">
                        <span></span><span></span><span></span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="app-nav" id="app-nav">
        <div class="container">
            <div class="nav-links">
                <a href="#home" class="nav-link active" data-page="home">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Trang chá»§</span>
                </a>
                <a href="#templates" class="nav-link" data-page="templates">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span class="nav-text">Templates</span>
                </a>
                <a href="#exercises" class="nav-link" data-page="exercises">
                    <span class="nav-icon">ğŸ‹ï¸</span>
                    <span class="nav-text">BÃ i táº­p</span>
                </a>
                <a href="#analytics" class="nav-link" data-page="analytics">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">Analytics</span>
                </a>
                <a href="#history" class="nav-link" data-page="history">
                    <span class="nav-icon">ğŸ“…</span>
                    <span class="nav-text">Lá»‹ch sá»­</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="app-main">
        <div class="container">
            <!-- Home Page -->
            <section id="home-page" class="page active">
                <div id="ai-suggestion-banner" class="ai-suggestion-banner" style="display:none;">
                    <div class="ai-content">
                        <span class="ai-icon">ğŸ¤–</span>
                        <div class="ai-text">
                            <strong>AI Suggestion</strong>
                            <p id="ai-suggestion-text"></p>
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="app.acceptAISuggestion()">Sá»­ dá»¥ng</button>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-icon">ğŸ‹ï¸</div><div class="stat-content"><div class="stat-value" id="total-workouts">0</div><div class="stat-label">Buá»•i táº­p</div></div></div>
                    <div class="stat-card"><div class="stat-icon">ğŸ“‹</div><div class="stat-content"><div class="stat-value" id="total-templates">0</div><div class="stat-label">Templates</div></div></div>
                    <div class="stat-card"><div class="stat-icon">ğŸ”¥</div><div class="stat-content"><div class="stat-value" id="this-week">0</div><div class="stat-label">Tuáº§n nÃ y</div></div></div>
                    <div class="stat-card"><div class="stat-icon">ğŸ’ª</div><div class="stat-content"><div class="stat-value" id="total-volume">0</div><div class="stat-label">Tá»•ng KG</div></div></div>
                </div>
                <div class="quick-actions">
                    <button class="quick-action-btn primary" onclick="app.startQuickWorkout()">
                        <span class="btn-icon">ğŸš€</span>
                        <span class="btn-text">Báº¯t Ä‘áº§u táº­p</span>
                    </button>
                    <button class="quick-action-btn" onclick="app.getAIWorkoutSuggestion()">
                        <span class="btn-icon">ğŸ¤–</span>
                        <span class="btn-text">AI Suggest</span>
                    </button>
                    <button class="quick-action-btn" onclick="app.createTemplate()">
                        <span class="btn-icon">â•</span>
                        <span class="btn-text">Táº¡o template</span>
                    </button>
                </div>
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Templates gáº§n Ä‘Ã¢y</h2>
                        <a href="#templates" class="section-link" onclick="app.loadPage('templates')">Xem táº¥t cáº£ â†’</a>
                    </div>
                    <div class="templates-grid" id="recent-templates"></div>
                </div>
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">ğŸ† Personal Records</h2>
                        <a href="#analytics" class="section-link" onclick="app.loadPage('analytics')">Xem analytics â†’</a>
                    </div>
                    <div id="recent-prs" class="pr-list"></div>
                </div>
            </section>

            <!-- Templates Page -->
            <section id="templates-page" class="page">
                <div class="page-header">
                    <h2 class="page-title">ğŸ“‹ Templates</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="app.createTemplate()">
                            <span class="btn-icon">â•</span>Táº¡o template
                        </button>
                        <button class="btn btn-secondary" onclick="document.getElementById('import-template-file').click()">
                            <span class="btn-icon">ğŸ“¥</span>Import
                        </button>
                        <button class="btn btn-secondary" onclick="app.exportTemplates()">
                            <span class="btn-icon">ğŸ“¤</span>Export
                        </button>
                    </div>
                </div>
                
                <div class="filters">
                    <input type="search" class="search-input" id="template-search" placeholder="ğŸ” TÃ¬m kiáº¿m templates...">
                    <select class="filter-select" id="template-filter">
                        <option value="">Táº¥t cáº£ Ä‘á»™ khÃ³</option>
                        <option value="beginner">ğŸŒ± NgÆ°á»i má»›i</option>
                        <option value="intermediate">âš¡ Trung cáº¥p</option>
                        <option value="advanced">ğŸ”¥ NÃ¢ng cao</option>
                    </select>
                </div>
                
                <input type="file" id="import-template-file" accept=".json" style="display:none;" onchange="app.importTemplates(event)">
                <div class="templates-grid" id="all-templates"></div>
            </section>

            <!-- Exercises Page - FIXED -->
            <section id="exercises-page" class="page">
                <div class="page-header">
                    <h2 class="page-title">ğŸ‹ï¸ Quáº£n lÃ½ bÃ i táº­p</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="app.openAddExerciseModal()">
                            <span class="btn-icon">â•</span>ThÃªm bÃ i táº­p
                        </button>
                        <button class="btn btn-secondary" onclick="document.getElementById('import-exercise-file').click()">
                            <span class="btn-icon">ğŸ“¥</span>Import
                        </button>
                        <button class="btn btn-secondary" onclick="app.exportExercises()">
                            <span class="btn-icon">ğŸ“¤</span>Export
                        </button>
                    </div>
                </div>
                
                <!-- Exercise Filters -->
                <div class="filters">
                    <input type="search" class="search-input" id="exercise-search" placeholder="ğŸ” TÃ¬m kiáº¿m bÃ i táº­p...">
                    <select class="filter-select" id="muscle-filter">
                        <option value="">Táº¥t cáº£ nhÃ³m cÆ¡</option>
                        <option value="chest">ğŸ’ª Ngá»±c</option>
                        <option value="back">ğŸ”™ LÆ°ng</option>
                        <option value="legs">ğŸ¦µ ChÃ¢n</option>
                        <option value="shoulders">ğŸ’ª Vai</option>
                        <option value="arms">ğŸ’ª Tay</option>
                        <option value="core">ğŸ”¥ Bá»¥ng</option>
                        <option value="cardio">â¤ï¸ Cardio</option>
                        <option value="fullbody">ğŸƒ ToÃ n thÃ¢n</option>
                        <option value="olympic">ğŸ‹ï¸ Olympic</option>
                        <option value="other">ğŸ’ª KhÃ¡c</option>
                    </select>
                    <select class="filter-select" id="equipment-filter">
                        <option value="">Táº¥t cáº£ thiáº¿t bá»‹</option>
                        <option value="bodyweight">Bodyweight</option>
                        <option value="barbell">Barbell</option>
                        <option value="dumbbell">Dumbbell</option>
                        <option value="machine">Machine</option>
                        <option value="cable">Cable</option>
                    </select>
                </div>
                
                <input type="file" id="import-exercise-file" accept=".json" style="display:none;" onchange="app.importExercises(event)">
                
                <!-- Exercise Stats -->
                <div class="exercise-stats" style="margin-bottom: 20px;">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ‹ï¸</div>
                            <div class="stat-content">
                                <div class="stat-value" id="total-exercises-count">0</div>
                                <div class="stat-label">Tá»•ng bÃ i táº­p</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ’ª</div>
                            <div class="stat-content">
                                <div class="stat-value" id="strength-exercises-count">0</div>
                                <div class="stat-label">Strength</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">â¤ï¸</div>
                            <div class="stat-content">
                                <div class="stat-value" id="cardio-exercises-count">0</div>
                                <div class="stat-label">Cardio</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ¤¸</div>
                            <div class="stat-content">
                                <div class="stat-value" id="bodyweight-exercises-count">0</div>
                                <div class="stat-label">Bodyweight</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Exercise Grid -->
                <div class="exercises-grid" id="all-exercises"></div>
            </section>

            <!-- Analytics Page - UPDATED -->
            <section id="analytics-page" class="page">
                <div class="page-header">
                    <h2 class="page-title">ğŸ“Š Analytics & Insights</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="app.generateReport()">
                            <span class="btn-icon">ğŸ“„</span>Generate Report
                        </button>
                        <button class="btn btn-secondary" onclick="app.refreshAnalytics()">
                            <span class="btn-icon">ğŸ”„</span>Refresh
                        </button>
                    </div>
                </div>
                
                <div class="time-range-selector">
                    <button class="time-btn active" data-range="week">Week</button>
                    <button class="time-btn" data-range="month">Month</button>
                    <button class="time-btn" data-range="quarter">Quarter</button>
                    <button class="time-btn" data-range="year">Year</button>
                </div>
                
                <div class="analytics-grid">
                    <div class="chart-container">
                        <h3>ğŸ“ˆ Volume Progression</h3>
                        <div class="chart-wrapper">
                            <canvas id="volume-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>ğŸ¯ Muscle Distribution</h3>
                        <div class="chart-wrapper">
                            <canvas id="muscle-distribution-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>ğŸ“… Workout Frequency</h3>
                        <div class="chart-wrapper">
                            <canvas id="frequency-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>ğŸ† Personal Records</h3>
                        <div class="chart-wrapper">
                            <canvas id="pr-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>ğŸ’ª Strength Standards</h3>
                        <div class="chart-wrapper">
                            <canvas id="strength-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>ğŸ”® Progress Prediction</h3>
                        <div class="chart-wrapper">
                            <canvas id="prediction-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Summary -->
                <div class="analytics-summary">
                    <div class="summary-card">
                        <h4>ğŸ¯ This Week</h4>
                        <div id="weekly-summary" class="summary-content">
                            <div class="summary-stat">
                                <span class="stat-label">Workouts:</span>
                                <span class="stat-value" id="weekly-workouts">-</span>
                            </div>
                            <div class="summary-stat">
                                <span class="stat-label">Volume:</span>
                                <span class="stat-value" id="weekly-volume">-</span>
                            </div>
                            <div class="summary-stat">
                                <span class="stat-label">PRs:</span>
                                <span class="stat-value" id="weekly-prs">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <h4>ğŸ“Š All Time</h4>
                        <div id="alltime-summary" class="summary-content">
                            <div class="summary-stat">
                                <span class="stat-label">Total Workouts:</span>
                                <span class="stat-value" id="total-workouts-analytics">-</span>
                            </div>
                            <div class="summary-stat">
                                <span class="stat-label">Total Volume:</span>
                                <span class="stat-value" id="total-volume-analytics">-</span>
                            </div>
                            <div class="summary-stat">
                                <span class="stat-label">Avg/Week:</span>
                                <span class="stat-value" id="avg-workouts-week">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="insights-section">
                    <h3>ğŸ¤– AI Insights</h3>
                    <div id="ai-insights" class="insights-grid">
                        <div class="insight-card">
                            <div class="insight-icon">ğŸ’¡</div>
                            <div class="insight-content">
                                <h4>Smart Recommendations</h4>
                                <p>AI insights will appear here based on your workout data and progress patterns.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- History Page -->
            <section id="history-page" class="page">
                <div class="page-header">
                    <h2 class="page-title">ğŸ“… Lá»‹ch sá»­ táº­p luyá»‡n</h2>
                    <div class="header-actions">
                        <input type="file" id="import-file" accept=".json" style="display:none;" onchange="app.handleImportFile(event)">
                        <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()"><span class="btn-icon">ğŸ“¥</span>Import</button>
                        <button class="btn btn-secondary" onclick="app.exportData()"><span class="btn-icon">ğŸ“¤</span>Export</button>
                    </div>
                </div>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="list">List</button>
                    <button class="view-btn" data-view="calendar">Calendar</button>
                </div>
                <div class="history-list" id="workout-history"></div>
                <div class="calendar-view" id="workout-calendar" style="display:none;"></div>
            </section>
        </div>
    </main>

    <!-- Workout Modal -->
    <div class="modal" id="workout-modal">
        <div class="modal-content workout-modal">
            <div class="modal-header">
                <h3 id="workout-title">Workout</h3>
                <div id="workout-timer-box">
                    <span class="timer-icon">â±ï¸</span>
                    <span class="timer-text" id="workout-timer">00:00</span>
                </div>
                <button class="modal-close" onclick="app.closeWorkout()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="workout-exercises" id="workout-exercises"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.pauseWorkout()">Táº¡m dá»«ng</button>
                <button class="btn btn-primary" onclick="app.finishWorkout()">HoÃ n thÃ nh</button>
            </div>
        </div>
    </div>

    <!-- Template Form Modal -->
    <div class="modal" id="template-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="template-form-title">Táº¡o Template</h3>
                <button class="modal-close" onclick="app.closeTemplateForm()">âœ•</button>
            </div>
            <form id="template-form" class="modal-body">
                <div class="form-group">
                    <label for="template-name">TÃªn template</label>
                    <input type="text" id="template-name" class="form-input" placeholder="VD: Push Day, Leg Day..." required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="template-level">Äá»™ khÃ³</label>
                        <select id="template-level" class="form-select">
                            <option value="">Chá»n Ä‘á»™ khÃ³</option>
                            <option value="beginner">ğŸŒ± NgÆ°á»i má»›i</option>
                            <option value="intermediate">âš¡ Trung cáº¥p</option>
                            <option value="advanced">ğŸ”¥ NÃ¢ng cao</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="template-duration">Thá»i gian (phÃºt)</label>
                        <input type="number" id="template-duration" class="form-input" placeholder="60" min="15" max="180">
                    </div>
                </div>
                <div class="form-group">
                    <label>BÃ i táº­p</label>
                    <div class="selected-exercises" id="selected-exercises"></div>
                    <button type="button" class="btn btn-secondary btn-block" onclick="app.selectExercises()">â• ThÃªm bÃ i táº­p</button>
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeTemplateForm()">Há»§y</button>
                <button class="btn btn-primary" onclick="app.saveTemplate()">LÆ°u template</button>
            </div>
        </div>
    </div>

    <!-- Template Preview Modal -->
    <div class="modal" id="template-preview-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="template-preview-title">Template</h3>
                <button class="modal-close" onclick="app.closeTemplatePreview()">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="template-preview-list"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.editTemplateFromPreview()">Edit</button>
                <button class="btn btn-primary" onclick="app.startWorkoutFromPreview()">Start Workout</button>
            </div>
        </div>
    </div>

    <!-- Exercise Selection Modal -->
    <div class="modal" id="exercise-select-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Chá»n bÃ i táº­p</h3>
                <button class="modal-close" onclick="app.closeExerciseSelect()">âœ•</button>
            </div>
            <div class="modal-body">
                <input type="search" class="search-input" id="exercise-select-search" placeholder="ğŸ” TÃ¬m kiáº¿m bÃ i táº­p...">
                <div class="exercise-select-list" id="exercise-select-list"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeExerciseSelect()">Há»§y</button>
                <button class="btn btn-primary" onclick="app.confirmExerciseSelection()">XÃ¡c nháº­n</button>
            </div>
        </div>
    </div>

    <!-- Exercise Add Modal - FIXED -->
	<div class="modal" id="exercise-add-modal">
		<div class="modal-content">
			<div class="modal-header">
				<h3>â• ThÃªm bÃ i táº­p má»›i</h3>
				<button class="modal-close" onclick="app.closeAddExerciseModal()">âœ•</button>
			</div>
			<div class="modal-body">
				<form id="exercise-add-form" onsubmit="event.preventDefault(); return false;">
					<div class="form-group">
						<label for="exercise-add-name">TÃªn bÃ i táº­p *</label>
						<input type="text" id="exercise-add-name" class="form-input" placeholder="VD: Bench Press, Squat..." required>
					</div>
					
					<div class="form-group">
						<label>NhÃ³m cÆ¡ *</label>
						<div id="exercise-add-muscle-group" class="chip-group" style="margin-top:8px;">
							<button type="button" class="chip-btn" data-value="chest">ğŸ’ª Ngá»±c</button>
							<button type="button" class="chip-btn" data-value="back">ğŸ”™ LÆ°ng</button>
							<button type="button" class="chip-btn" data-value="legs">ğŸ¦µ ChÃ¢n</button>
							<button type="button" class="chip-btn" data-value="shoulders">ğŸ’ª Vai</button>
							<button type="button" class="chip-btn" data-value="arms">ğŸ’ª Tay</button>
							<button type="button" class="chip-btn" data-value="core">ğŸ”¥ Bá»¥ng</button>
							<button type="button" class="chip-btn" data-value="cardio">â¤ï¸ Cardio</button>
							<button type="button" class="chip-btn" data-value="fullbody">ğŸƒ ToÃ n thÃ¢n</button>
							<button type="button" class="chip-btn" data-value="olympic">ğŸ‹ï¸ Olympic</button>
							<button type="button" class="chip-btn" data-value="other">ğŸ’ª KhÃ¡c</button>
						</div>
						<input type="hidden" id="exercise-add-muscle" required>
					</div>
					
					<div class="form-row">
						<div class="form-group">
							<label for="exercise-add-type">Loáº¡i bÃ i táº­p</label>
							<select id="exercise-add-type" class="form-select">
								<option value="strength">ğŸ’ª Strength</option>
								<option value="bodyweight">ğŸ¤¸ Bodyweight</option>
								<option value="cardio">â¤ï¸ Cardio</option>
								<option value="hiit">ğŸ”¥ HIIT</option>
								<option value="mobility">ğŸ§˜ Mobility</option>
								<option value="stretching">ğŸ¤¸ Stretching</option>
								<option value="plyometrics">âš¡ Plyometrics</option>
							</select>
						</div>
						
						<div class="form-group">
							<label for="exercise-add-equipment">Thiáº¿t bá»‹</label>
							<select id="exercise-add-equipment" class="form-select">
								<option value="bodyweight">ğŸ¤¸ Bodyweight</option>
								<option value="barbell">ğŸ‹ï¸ Barbell</option>
								<option value="dumbbell">ğŸ‹ï¸ Dumbbell</option>
								<option value="machine">ğŸ”§ Machine</option>
								<option value="cable">ğŸ”— Cable</option>
								<option value="weightedbodyweight">âš–ï¸ Weighted Bodyweight</option>
								<option value="assistedbodyweight">ğŸ¤ Assisted Bodyweight</option>
								<option value="reponly">ğŸ”¢ Rep Only</option>
								<option value="cardio">â¤ï¸ Cardio Equipment</option>
								<option value="duration">â±ï¸ Duration Based</option>
							</select>
						</div>
					</div>
					
					<div class="form-group">
						<label for="exercise-add-unit">ÄÆ¡n vá»‹ Ä‘o</label>
						<select id="exercise-add-unit" class="form-select">
							<option value="kg">ğŸ‹ï¸ Kilograms (kg)</option>
							<option value="lb">ğŸ‹ï¸ Pounds (lb)</option>
							<option value="reps">ğŸ”¢ Reps only</option>
							<option value="minute">â±ï¸ Minutes</option>
							<option value="second">â±ï¸ Seconds</option>
						</select>
					</div>
					
					<div class="form-group">
						<label for="exercise-add-description">MÃ´ táº£ (tÃ¹y chá»n)</label>
						<textarea id="exercise-add-description" class="form-input" rows="2" placeholder="HÆ°á»›ng dáº«n ngáº¯n gá»n vá» cÃ¡ch thá»±c hiá»‡n..."></textarea>
					</div>
					
					<!-- Image section -->
					<div class="form-group">
						<label>HÃ¬nh áº£nh bÃ i táº­p (tÃ¹y chá»n)</label>
						<div class="image-input-tabs">
							<button type="button" class="tab-btn active" onclick="app.switchImageTab('add', 'upload', event)">ğŸ“¤ Upload</button>
							<button type="button" class="tab-btn" onclick="app.switchImageTab('add', 'url', event)">ğŸ”— URL</button>
						</div>
						
						<!-- Upload tab -->
						<div id="exercise-add-upload-tab" class="image-tab active">
							<div class="image-upload-area">
								<input type="file" id="exercise-add-image" accept="image/*" onchange="app.previewExerciseImage(event, 'add')" style="display:none;">
								<div id="exercise-add-image-preview" class="image-preview-container">
									<label for="exercise-add-image" class="upload-placeholder">
										<span class="upload-icon">ğŸ“·</span>
										<span class="upload-text">Click Ä‘á»ƒ táº£i áº£nh lÃªn</span>
									</label>
								</div>
							</div>
						</div>
						
						<!-- URL tab -->
						<div id="exercise-add-url-tab" class="image-tab" style="display:none;">
							<div class="url-input-wrapper">
								<input type="url" 
									   id="exercise-add-image-url" 
									   class="form-input" 
									   placeholder="https://example.com/image.jpg"
									   onpaste="app.handleImageUrlPaste(event, 'add')"
									   oninput="app.debounceImageUrlPreview('add')">
								<button type="button" class="btn btn-sm" onclick="app.previewImageFromUrl('add')">Preview</button>
							</div>
							<div id="exercise-add-url-preview" class="image-preview-container" style="margin-top: 10px; display:none;">
								<!-- URL preview will appear here -->
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" onclick="app.closeAddExerciseModal()">Há»§y</button>
				<button type="button" class="btn btn-primary" onclick="app.saveAddExercise()">â• ThÃªm bÃ i táº­p</button>
			</div>
		</div>
	</div>

    <!-- Exercise Edit Modal - FIXED -->
    <div class="modal" id="exercise-edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="exercise-edit-title">âœï¸ Chá»‰nh sá»­a bÃ i táº­p</h3>
                <button class="modal-close" onclick="app.closeEditExerciseModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="exercise-edit-form">
                    <div class="form-group">
                        <label for="exercise-edit-name">TÃªn bÃ i táº­p</label>
                        <input type="text" id="exercise-edit-name" class="form-input" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="exercise-edit-muscle">NhÃ³m cÆ¡</label>
                            <select id="exercise-edit-muscle" class="form-select">
                                <option value="chest">ğŸ’ª Ngá»±c</option>
                                <option value="back">ğŸ”™ LÆ°ng</option>
                                <option value="legs">ğŸ¦µ ChÃ¢n</option>
                                <option value="shoulders">ğŸ’ª Vai</option>
                                <option value="arms">ğŸ’ª Tay</option>
                                <option value="core">ğŸ”¥ Bá»¥ng</option>
                                <option value="cardio">â¤ï¸ Cardio</option>
                                <option value="fullbody">ğŸƒ ToÃ n thÃ¢n</option>
                                <option value="olympic">ğŸ‹ï¸ Olympic</option>
                                <option value="other">ğŸ’ª KhÃ¡c</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="exercise-edit-type">Loáº¡i bÃ i táº­p</label>
                            <select id="exercise-edit-type" class="form-select">
                                <option value="strength">ğŸ’ª Strength</option>
                                <option value="bodyweight">ğŸ¤¸ Bodyweight</option>
                                <option value="cardio">â¤ï¸ Cardio</option>
                                <option value="hiit">ğŸ”¥ HIIT</option>
                                <option value="mobility">ğŸ§˜ Mobility</option>
                                <option value="stretching">ğŸ¤¸ Stretching</option>
                                <option value="plyometrics">âš¡ Plyometrics</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="exercise-edit-equipment">Thiáº¿t bá»‹</label>
                            <select id="exercise-edit-equipment" class="form-select">
                                <option value="bodyweight">ğŸ¤¸ Bodyweight</option>
                                <option value="barbell">ğŸ‹ï¸ Barbell</option>
                                <option value="dumbbell">ğŸ‹ï¸ Dumbbell</option>
                                <option value="machine">ğŸ”§ Machine</option>
                                <option value="cable">ğŸ”— Cable</option>
                                <option value="weightedbodyweight">âš–ï¸ Weighted Bodyweight</option>
                                <option value="assistedbodyweight">ğŸ¤ Assisted Bodyweight</option>
                                <option value="reponly">ğŸ”¢ Rep Only</option>
                                <option value="cardio">â¤ï¸ Cardio Equipment</option>
                                <option value="duration">â±ï¸ Duration Based</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="exercise-edit-unit">ÄÆ¡n vá»‹ Ä‘o</label>
                            <select id="exercise-edit-unit" class="form-select">
                                <option value="kg">ğŸ‹ï¸ Kilograms (kg)</option>
                                <option value="lb">ğŸ‹ï¸ Pounds (lb)</option>
                                <option value="reps">ğŸ”¢ Reps only</option>
                                <option value="minute">â±ï¸ Minutes</option>
                                <option value="second">â±ï¸ Seconds</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="exercise-edit-description">MÃ´ táº£</label>
                        <textarea id="exercise-edit-description" class="form-input" rows="2"></textarea>
                    </div>
					<div class="form-group">
						<label>HÃ¬nh áº£nh bÃ i táº­p</label>
						<div class="image-input-tabs">
							<button type="button" class="tab-btn active" onclick="app.switchImageTab('edit', 'upload')">ğŸ“¤ Upload</button>
							<button type="button" class="tab-btn" onclick="app.switchImageTab('edit', 'url')">ğŸ”— URL</button>
						</div>
						
						<!-- Upload tab -->
						<div id="exercise-edit-upload-tab" class="image-tab active">
							<div class="image-upload-area">
								<input type="file" id="exercise-edit-image" accept="image/*" onchange="app.previewExerciseImage(event, 'edit')" style="display:none;">
								<div id="exercise-edit-image-preview" class="image-preview-container">
									<label for="exercise-edit-image" class="upload-placeholder">
										<span class="upload-icon">ğŸ“·</span>
										<span class="upload-text">Click Ä‘á»ƒ thay Ä‘á»•i áº£nh</span>
									</label>
								</div>
							</div>
						</div>
						
						<!-- URL tab -->
						<div id="exercise-edit-url-tab" class="image-tab" style="display:none;">
							<div class="url-input-wrapper">
								<input type="url" 
									   id="exercise-edit-image-url" 
									   class="form-input" 
									   placeholder="https://example.com/image.jpg"
									   onpaste="app.handleImageUrlPaste(event, 'edit')"
									   oninput="app.debounceImageUrlPreview('edit')">
								<button type="button" class="btn btn-sm" onclick="app.previewImageFromUrl('edit')">Preview</button>
							</div>
							<div id="exercise-edit-url-preview" class="image-preview-container" style="margin-top: 10px; display:none;">
								<!-- URL preview will appear here -->
							</div>
						</div>
					</div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeEditExerciseModal()">Há»§y</button>
                <button class="btn btn-primary" onclick="app.saveEditExercise()">ğŸ’¾ LÆ°u thay Ä‘á»•i</button>
            </div>
        </div>
    </div>

    <!-- Exercise History Modal -->
    <div class="modal" id="exercise-history-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="exercise-history-title">ğŸ“Š Lá»‹ch sá»­ bÃ i táº­p</h3>
                <button class="modal-close" onclick="app.closeExerciseHistory()">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="exercise-history-chart" class="chart-container" style="margin-bottom: 20px;">
                    <canvas id="exercise-progress-chart"></canvas>
                </div>
                <div id="exercise-history-list"></div>
            </div>
        </div>
    </div>

    <!-- Exercise Picker Modal (for replacement) -->
    <div class="modal" id="exercise-picker-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ”„ Chá»n bÃ i táº­p thay tháº¿</h3>
                <button class="modal-close" onclick="app.closeExercisePicker()">âœ•</button>
            </div>
            <div class="modal-body">
                <input type="search" class="search-input" placeholder="ğŸ” TÃ¬m kiáº¿m bÃ i táº­p thay tháº¿...">
                <div id="exercise-picker-list"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeExercisePicker()">Há»§y</button>
                <button class="btn btn-primary" id="confirm-ex-picker-btn">XÃ¡c nháº­n</button>
            </div>
        </div>
    </div>

    <!-- Workout Detail Modal -->
    <div class="modal" id="workout-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“Š Chi tiáº¿t Workout</h3>
                <button class="modal-close" onclick="document.getElementById('workout-detail-modal').classList.remove('active')">âœ•</button>
            </div>
            <div class="modal-body" id="workout-detail-content"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âš™ï¸ CÃ i Ä‘áº·t</h3>
                <button class="modal-close" onclick="app.closeSettings()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>ğŸ”” Notifications</h4>
                    <label class="toggle-setting">
                        <input type="checkbox" id="enable-notifications" onchange="app.toggleNotifications()">
                        <span>ThÃ´ng bÃ¡o rest timer</span>
                    </label>
                    <label class="toggle-setting">
                        <input type="checkbox" id="enable-pr-notifications" onchange="app.togglePRNotifications()">
                        <span>ThÃ´ng bÃ¡o Personal Records</span>
                    </label>
                </div>
                
                <div class="settings-section">
                    <h4>âš–ï¸ Units</h4>
                    <label class="radio-setting">
                        <input type="radio" name="weight-unit" value="kg" checked onchange="app.setWeightUnit('kg')">
                        <span>Kilograms (kg)</span>
                    </label>
                    <label class="radio-setting">
                        <input type="radio" name="weight-unit" value="lb" onchange="app.setWeightUnit('lb')">
                        <span>Pounds (lb)</span>
                    </label>
                </div>
                
                <div class="settings-section">
                    <h4>ğŸ¨ Theme</h4>
                    <label class="radio-setting">
                        <input type="radio" name="theme" value="auto" checked onchange="app.setTheme('auto')">
                        <span>Auto (System)</span>
                    </label>
                    <label class="radio-setting">
                        <input type="radio" name="theme" value="light" onchange="app.setTheme('light')">
                        <span>Light</span>
                    </label>
                    <label class="radio-setting">
                        <input type="radio" name="theme" value="dark" onchange="app.setTheme('dark')">
                        <span>Dark</span>
                    </label>
                </div>
                
                <div class="settings-section">
                    <h4>ğŸ¤– AI Features</h4>
                    <label class="toggle-setting">
                        <input type="checkbox" id="enable-ai-suggestions" checked onchange="app.toggleAISuggestions()">
                        <span>AI Workout Suggestions</span>
                    </label>
                    <label class="toggle-setting">
                        <input type="checkbox" id="enable-form-checks" checked onchange="app.toggleFormChecks()">
                        <span>AI Form Checks</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Backend Settings Modal -->
    <div class="modal" id="backend-settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>â˜ï¸ Sync Settings</h3>
                <button class="modal-close" onclick="app.closeBackendSettings()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>Storage Provider</h4>
                    <label class="radio-setting">
                        <input type="radio" name="provider" value="local" checked onchange="app.toggleProviderConfig('local')">
                        <span>Local Storage Only</span>
                    </label>
                    <label class="radio-setting">
                        <input type="radio" name="provider" value="nas" onchange="app.toggleProviderConfig('nas')">
                        <span>Synology NAS</span>
                    </label>
                    <label class="radio-setting">
                        <input type="radio" name="provider" value="onedrive" onchange="app.toggleProviderConfig('onedrive')">
                        <span>OneDrive</span>
                    </label>
                </div>
                <div id="nas-config" class="provider-config" style="display:none;">
                    <h4>NAS Configuration</h4>
                    <div class="form-group">
                        <label>NAS URL</label>
                        <input type="text" class="form-input" placeholder="http://192.168.1.100:5000" id="nas-url">
                    </div>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" class="form-input" placeholder="Username" id="nas-username">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" class="form-input" placeholder="Password" id="nas-password">
                    </div>
                </div>
                <div id="onedrive-config" class="provider-config" style="display:none;">
                    <h4>OneDrive Configuration</h4>
                    <div class="onedrive-status" id="onedrive-status">
                        <p>Not connected</p>
                    </div>
                    <button class="btn btn-primary" onclick="app.authenticateOneDrive()">
                        Connect OneDrive
                    </button>
                </div>
                <div class="sync-status">
                    <h4>Sync Status</h4>
                    <div id="sync-status-info">
                        <p>Last sync: <span id="last-sync">Never</span></p>
                        <p>Status: <span id="sync-status-text">Not configured</span></p>
                    </div>
                    <button class="btn btn-secondary" onclick="app.manualSync()">Sync Now</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeBackendSettings()">Cancel</button>
                <button class="btn btn-primary" onclick="app.saveBackendSettings()">Save</button>
            </div>
        </div>
    </div>
	<div class="exercise-actions" style="display:flex;align-items:center;position:relative;">
		<button class="btn-ex-action" 
				onmousedown="event.stopPropagation()" 
				onclick="event.stopPropagation(); app.toggleEditMenuTemplate(event, ${exIndex})" 
				title="TÃ¹y chá»n">
			<span class="menu-icon">â‹¯</span>
		</button>
		<div class="exercise-menu" 
			 id="edit-menu-${exIndex}" 
			 style="display:none;"
			 onclick="event.stopPropagation()">
			<button onclick="event.stopPropagation(); app.moveExerciseUp(${exIndex}); document.getElementById('edit-menu-${exIndex}').style.display='none';" ${exIndex === 0 ? 'disabled style="opacity:0.5;"' : ''}>â¬†ï¸ Di chuyá»ƒn lÃªn</button>
			<button onclick="event.stopPropagation(); app.moveExerciseDown(${exIndex}); document.getElementById('edit-menu-${exIndex}').style.display='none';" ${exIndex === this.selectedExercises.length - 1 ? 'disabled style="opacity:0.5;"' : ''}>â¬‡ï¸ Di chuyá»ƒn xuá»‘ng</button>
			<button onclick="event.stopPropagation(); app.duplicateExercise(${exIndex}); document.getElementById('edit-menu-${exIndex}').style.display='none';">ğŸ“‹ NhÃ¢n Ä‘Ã´i</button>
			<hr style="margin:4px 0;border:none;border-top:1px solid var(--border-color);">
			<button onclick="event.stopPropagation(); app.addNoteToTemplateExercise(${exIndex}); document.getElementById('edit-menu-${exIndex}').style.display='none';">ğŸ“ Ghi chÃº</button>
			<button onclick="event.stopPropagation(); app.addStickyToTemplateExercise(${exIndex}); document.getElementById('edit-menu-${exIndex}').style.display='none';">ğŸ“Œ Sticky Note</button>
			<button onclick="event.stopPropagation(); app.addWarmupSetToTemplate(${exIndex}); document.getElementById('edit-menu-${exIndex}').style.display='none';">â• Warm-up Set</button>
			<button onclick="event.stopPropagation(); app.updateRestTimersTemplate(${exIndex}); document.getElementById('edit-menu-${exIndex}').style.display='none';">â±ï¸ Update Rest</button>
			<button onclick="event.stopPropagation(); app.replaceExerciseInTemplate(${exIndex}); document.getElementById('edit-menu-${exIndex}').style.display='none';">ğŸ”„ Thay tháº¿</button>
			<button onclick="event.stopPropagation(); app.createSupersetInTemplate(${exIndex}); document.getElementById('edit-menu-${exIndex}').style.display='none';">â¯â¯ Superset</button>
			<button onclick="event.stopPropagation(); app.exercisePreferencesTemplate(${exIndex}, event); document.getElementById('edit-menu-${exIndex}').style.display='none';">âš™ï¸ CÃ i Ä‘áº·t</button>
			<button class="danger" onclick="event.stopPropagation(); app.removeSelectedExercise(${exIndex}); document.getElementById('edit-menu-${exIndex}').style.display='none';" style="color:#f44336;">âŒ XÃ³a bÃ i</button>
		</div>
	</div>

    <!-- Rest Timer -->
    <div class="rest-timer" id="rest-timer">
        <div class="rest-timer-content">
            <div class="rest-timer-label">Thá»i gian nghá»‰</div>
            <div class="rest-timer-time" id="rest-time">02:00</div>
            <div class="rest-timer-actions">
                <button class="rest-timer-btn" onclick="app.skipRest()">Bá» qua</button>
                <button class="rest-timer-btn" onclick="app.addRestTime(30)">+30s</button>
            </div>
        </div>
    </div>

    <!-- PR Notification -->
    <div class="pr-notification" id="pr-notification" style="display:none;">
        <div class="pr-content">
            <span class="pr-icon">ğŸ†</span>
            <span class="pr-text">Personal Record!</span>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Context Menu for units -->
    <div id="unit-context-menu" class="context-menu" style="display:none;position:absolute;z-index:1200;"></div>

    <!-- Main JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/backend.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/app.js"></script>

    <!-- PWA & Service Worker, Install Banner, Online/Offline, New Version Notify -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered');
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                app.showToast('New version available! Refresh to update.', 'info');
                            }
                        });
                    });
                })
                .catch(err => console.error('Service Worker registration failed:', err));
        }

        // Install PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-banner').style.display = 'flex';
        });

        document.getElementById('install-btn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    console.log('PWA installed');
                }
                deferredPrompt = null;
                hideInstallBanner();
            }
        });

        function hideInstallBanner() {
            document.getElementById('install-banner').style.display = 'none';
        }

        // Handle offline/online status
        window.addEventListener('online', () => {
            document.getElementById('offline-indicator').style.display = 'none';
            app.showToast('Back online!', 'success');
            if (app.backend) {
                app.backend.processSyncQueue();
            }
        });

        window.addEventListener('offline', () => {
            document.getElementById('offline-indicator').style.display = 'flex';
            app.showToast('Báº¡n Ä‘ang offline', 'warning');
        });

        // Global click handler for menus
        document.addEventListener('click', function (e) {
            document.querySelectorAll('.exercise-menu').forEach(menu => {
                if (!menu.contains(e.target) && !e.target.classList.contains('btn-ex-action') && !e.target.classList.contains('menu-icon')) {
                    menu.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>